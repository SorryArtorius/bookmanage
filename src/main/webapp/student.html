<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="/java16_SSM_816_war/js/jquery-3.6.0.js" type="text/javascript"></script>
    <script>


        function init() {
            initData(1);
            initGrade();
        }


        function initData(index) {
            $.getJSON("/java16_SSM_816_war/student/selectStudent", {index: index}, function (json) {
                var tb = $("#tb");
                var str = "";
                $("#tb tr:gt(0)").remove();
                for (var i = 0; i < json.list.length; i++) {
                    str += "<tr>";

                    str += "<td><input type='checkbox' name='all_check' onclick='checkbox_all()' value='" + json.list[i].studentNo + "' /></td>";

                    str += "<td>" + json.list[i].studentNo + "</td>";


                    str += "<td>" + json.list[i].studentName + "</td>";


                    str += "<td>" + json.list[i].loginPwd + "</td>";


                    str += "<td>" + json.list[i].sex + "</td>";


                    str += "<td>" + json.list[i].grade.gradeName + "</td>";


                    str += "<td>" + json.list[i].phone + "</td>";


                    str += "<td>" + json.list[i].bornDate + "</td>";


                    str += "<td>" + json.list[i].email + "</td>";


                    str += "<td>" + json.list[i].identityCard + "</td>";

                    str += "<td><a href='#'>编 辑</a>|<a href='#' onclick='return selectDelete(" + json.list[i].studentNo + ");'>删 除</a>";

                }

                tb.append(str);

                str = "";
                var pagesNext = $("#pagesNext");
                document.getElementById("pagesNext").innerHTML = "";
                str += "共" + json.total + "条数据";
                str += "<button onclick='initData(1)'>首页</button>";


                if (json.hasPreviousPage) {
                    str += "<a href='#' onclick='return initData(" + json.prePage + ")'>上一页</a>";
                } else {
                    str += "<a href='#' onclick=' return initData(1)'>上一页</a>";
                }
                str += json.pageNum + "/" + json.pages;
                if (json.hasNextPage) {
                    str += "<a href='#' onclick='return initData(" + (json.nextPage) + ")'>下一页</a>";
                } else {
                    str += "<a href='#' onclick=' return initData(" + json.pages + ")'>下一页</a>";
                }
                str += "<button onclick='initData(" + json.pages + ")'>末页</button>";
                str += "<button onclick='deleteAll();'>删除所选类容</button>";
                pagesNext.append(str);
                return false;
            });

        }


        /**
         * 年级信息预加载
         */
        function initGrade() {
            $.getJSON("/java16_SSM_816_war/grade/getGrades", function(json){
                var str ="";
                str += "<option value='0'>查询所有</option>"
                for (var i = 0; i < json.length; i++) {
                    str += "<option value='"+json[i].gradeId+"'>"+json[i].gradeName+"</option>"
                }
                $("#select").append(str);
            });
        }


        /**
         * 全选与反选
         * @param all
         */
        function checkAll(all) {
            var all_check = document.getElementsByName("all_check");
            for (var i = 0; i < all_check.length; i++) {
                if (all_check[i].type == "checkbox") {
                    all_check[i].checked = all.checked;
                }
            }
        }

        function checkbox_all() {
            var boolean = true;
            var all_check = document.getElementsByName("all_check");
            for (var i = 0; i < all_check.length; i++) {
                if (all_check[i].checked == false) {
                    boolean = false;
                    break;
                }
            }
            document.getElementById("tag").checked = boolean;
        }

        function deleteAll() {


            var r = confirm("您确定删除吗？")
            if (r == true) {
                var all_check = document.getElementsByName("all_check");
                var str = "";
                for (var i = 0; i < all_check.length; i++) {
                    if (all_check[i].checked == true) {
                        str += all_check[i].value + ",";
                    }
                }
                $.getJSON("/java16_SSM_816_war/student/deleteStudents", {studentNo: str}, function (json) {
                    console.log(json);
                    if (json == true) {
                        alert("删除成功!");
                        initData(1);
                    } else {
                        alert("删除失败!");
                    }
                });
            }

        }

        function selectDelete(studentNo) {
            var r = confirm("您确定删除吗？")
            if (r == true) {
                $.getJSON("/java16_SSM_816_war/student/deleteStudent", {studentNo: studentNo}, function (json) {
                    console.log(json);
                    if (json == true) {
                        alert("删除成功！");
                        initData(1);
                    } else {
                        alert("删除失败！");
                    }
                });
            }
        }


        function selectButton() {
            var select = $("#select").val();
            var input = $("#selectInput").val();
            $.getJSON("/java16_SSM_816_war/student/fuzzyQueryStudent", { gradeId: select, studentName: input }, function(json){
                var tb = $("#tb");
                var str = "";
                $("#tb tr:gt(0)").remove();
                for (var i = 0; i < json.length; i++) {
                    str += "<tr>";

                    str += "<td><input type='checkbox' name='all_check' onclick='checkbox_all()' value='" + json[i].studentNo + "' /></td>";

                    str += "<td>" + json[i].studentNo + "</td>";


                    str += "<td>" + json[i].studentName + "</td>";


                    str += "<td>" + json[i].loginPwd + "</td>";


                    str += "<td>" + json[i].sex + "</td>";


                    str += "<td>" + json[i].grade.gradeName + "</td>";


                    str += "<td>" + json[i].phone + "</td>";


                    str += "<td>" + json[i].bornDate + "</td>";


                    str += "<td>" + json[i].email + "</td>";


                    str += "<td>" + json[i].identityCard + "</td>";

                    str += "<td><a href='#'>编 辑</a>|<a href='#' onclick='return selectDelete(" + json[i].studentNo + ");'>删 除</a>";

                }

                tb.append(str);
            });
        }

    </script>

</head>
<body onload="init()">
<div id="selectBox">
    <p>请输入搜索内容：<input id="selectInput" type="text"/>
        <select id="select"></select>
        <button type="button" onclick="selectButton()">搜索</button>
    </p>
</div>
<table border="1" id="tb">
    <th><input id="tag" onclick="checkAll(this)" type="checkbox"/></th>
    <th>学号</th>
    <th>姓名</th>
    <th>密码</th>
    <th>性别</th>
    <th>年级</th>
    <th>联系电话</th>
    <th>出生日期</th>
    <th>电子邮箱</th>
    <th>身份证号</th>
    <th>操作</th>
</table>
<div id="pagesNext"></div>
</body>
</html>